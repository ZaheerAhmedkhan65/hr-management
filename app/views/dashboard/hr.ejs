<%- include('../layouts/application', { title: 'HR Dashboard' , subtitle: 'Employee Management & Analytics' ,
    css: 'dashboard' }) -%>

    <style>
        .hr-stat-card {
            border-radius: 15px;
            border: none;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s;
            height: 100%;
        }

        .hr-stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .attendance-stat {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .leave-stat {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .expense-stat {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .salary-stat {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        .stat-card-content {
            padding: 20px;
            color: white;
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 15px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            opacity: 0.9;
            font-size: 0.875rem;
            margin-bottom: 10px;
        }

        .stat-change {
            font-size: 0.75rem;
            opacity: 0.8;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .employee-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .task-item {
            padding: 12px 15px;
            border-radius: 10px;
            background: #f8f9fa;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s;
        }

        .task-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .task-priority {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .priority-high {
            background: #dc3545;
        }

        .priority-medium {
            background: #ffc107;
        }

        .priority-low {
            background: #28a745;
        }
    </style>

    <div class="row g-4 mb-4">
        <!-- Statistics Cards -->
        <div class="col-xl-3 col-md-6">
            <div class="hr-stat-card attendance-stat">
                <div class="stat-card-content">
                    <div class="stat-icon">
                        <i class="fas fa-user-clock"></i>
                    </div>
                    <div class="stat-value">
                        <%= stats.total_employees || 0 %>
                    </div>
                    <div class="stat-label">Total Employees</div>
                    <div class="stat-change">
                        <i class="fas fa-user-plus"></i>
                        <%= stats.new_employees_this_month || 0 %> new this month
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="hr-stat-card leave-stat">
                <div class="stat-card-content">
                    <div class="stat-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="stat-value">
                        <%= stats.present_today || 0 %>
                    </div>
                    <div class="stat-label">Present Today</div>
                    <div class="stat-change">
                        <i class="fas fa-chart-line"></i>
                        <%= stats.attendance_rate || '0' %>% attendance rate
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="hr-stat-card expense-stat">
                <div class="stat-card-content">
                    <div class="stat-icon">
                        <i class="fas fa-file-invoice-dollar"></i>
                    </div>
                    <div class="stat-value">
                        <%= stats.pending_leaves || 0 %>
                    </div>
                    <div class="stat-label">Pending Leaves</div>
                    <div class="stat-change">
                        <i class="fas fa-exclamation-circle"></i>
                        Needs your approval
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="hr-stat-card salary-stat">
                <div class="stat-card-content">
                    <div class="stat-icon">
                        <i class="fas fa-money-check-alt"></i>
                    </div>
                    <div class="stat-value">
                        <%= stats.pending_expenses || 0 %>
                    </div>
                    <div class="stat-label">Pending Expenses</div>
                    <div class="stat-change">
                        <i class="fas fa-dollar-sign"></i>
                        $<%= stats.total_pending_amount || '0' %> total
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <!-- Left Column -->
        <div class="col-lg-8">
            <!-- Attendance Chart -->
            <div class="card hr-stat-card mb-4">
                <div class="card-header bg-white border-0">
                    <h5 class="card-title mb-0">Attendance This Month</h5>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="attendanceChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Recent Employees -->
            <div class="card hr-stat-card">
                <div class="card-header bg-white border-0 d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">Recent Employees</h5>
                    <a href="/users/list" class="btn btn-sm btn-outline-primary">View All</a>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>Employee</th>
                                    <th>Department</th>
                                    <th>Position</th>
                                    <th>Status</th>
                                    <th>Joining Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% if (recentEmployees && recentEmployees.length> 0) { %>
                                    <% recentEmployees.forEach(employee=> { %>
                                        <tr>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <div class="flex-shrink-0">
                                                        <% if (employee.profile_image) { %>
                                                            <img src="<%= employee.profile_image %>"
                                                                alt="<%= employee.first_name %>"
                                                                class="employee-avatar">
                                                            <% } else { %>
                                                                <div
                                                                    class="employee-avatar bg-light text-dark d-flex align-items-center justify-content-center">
                                                                    <i class="fas fa-user"></i>
                                                                </div>
                                                                <% } %>
                                                    </div>
                                                    <div class="flex-grow-1 ms-3">
                                                        <h6 class="mb-0">
                                                            <%= employee.first_name %>
                                                                <%= employee.last_name %>
                                                        </h6>
                                                        <small class="text-muted">
                                                            <%= employee.email %>
                                                        </small>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                <%= employee.department_name || 'N/A' %>
                                            </td>
                                            <td>
                                                <%= employee.position || 'N/A' %>
                                            </td>
                                            <td>
                                                <span class="badge bg-<%= 
                                                employee.status === 'active' ? 'success' : 
                                                employee.status === 'inactive' ? 'secondary' : 'warning' 
                                            %>">
                                                    <%= employee.status %>
                                                </span>
                                            </td>
                                            <td>
                                                <%= new Date(employee.hire_date).toLocaleDateString() %>
                                            </td>
                                            <td>
                                                <div class="btn-group btn-group-sm">
                                                    <a href="/users/view/<%= employee.id %>"
                                                        class="btn btn-outline-primary" data-bs-toggle="tooltip"
                                                        title="View">
                                                        <i class="fas fa-eye"></i>
                                                    </a>
                                                    <a href="/users/edit/<%= employee.id %>"
                                                        class="btn btn-outline-secondary" data-bs-toggle="tooltip"
                                                        title="Edit">
                                                        <i class="fas fa-edit"></i>
                                                    </a>
                                                </div>
                                            </td>
                                        </tr>
                                        <% }) %>
                                            <% } else { %>
                                                <tr>
                                                    <td colspan="6" class="text-center py-4">
                                                        <div class="text-muted">
                                                            <i class="fas fa-users fa-2x mb-3"></i>
                                                            <p>No employees found</p>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <% } %>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column -->
        <div class="col-lg-4">
            <!-- Upcoming Tasks -->
            <div class="card hr-stat-card mb-4">
                <div class="card-header bg-white border-0">
                    <h5 class="card-title mb-0">Upcoming Tasks</h5>
                </div>
                <div class="card-body">
                    <% if (upcomingTasks && upcomingTasks.length> 0) { %>
                        <% upcomingTasks.forEach(task=> { %>
                            <div class="task-item">
                                <div class="d-flex align-items-center">
                                    <div class="task-priority <%= 
                                    task.priority === 'high' ? 'priority-high' : 
                                    task.priority === 'medium' ? 'priority-medium' : 'priority-low' 
                                %>"></div>
                                    <div>
                                        <h6 class="mb-0">
                                            <%= task.title %>
                                        </h6>
                                        <small class="text-muted">
                                            <i class="far fa-clock me-1"></i>
                                            <%= task.due_date %>
                                        </small>
                                    </div>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" <%=task.completed ? 'checked' : ''
                                        %>>
                                </div>
                            </div>
                            <% }) %>
                                <% } else { %>
                                    <div class="text-center py-4">
                                        <div class="text-muted">
                                            <i class="fas fa-tasks fa-2x mb-3"></i>
                                            <p>No upcoming tasks</p>
                                        </div>
                                    </div>
                                    <% } %>
                </div>
                <div class="card-footer bg-white border-0 text-center">
                    <a href="/tasks" class="text-decoration-none small">View All Tasks</a>
                </div>
            </div>

            <!-- Department Distribution -->
            <div class="card hr-stat-card mb-4">
                <div class="card-header bg-white border-0">
                    <h5 class="card-title mb-0">Department Distribution</h5>
                </div>
                <div class="card-body">
                    <div class="chart-container" style="height: 250px;">
                        <canvas id="departmentChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Quick Links -->
            <div class="card hr-stat-card">
                <div class="card-header bg-white border-0">
                    <h5 class="card-title mb-0">Quick Links</h5>
                </div>
                <div class="card-body">
                    <div class="row g-2">
                        <div class="col-6">
                            <a href="/attendance/company" class="btn btn-outline-primary w-100 mb-2">
                                <i class="fas fa-user-clock me-2"></i> Attendance
                            </a>
                        </div>
                        <div class="col-6">
                            <a href="/leaves/pending" class="btn btn-outline-success w-100 mb-2">
                                <i class="fas fa-calendar-alt me-2"></i> Leaves
                            </a>
                        </div>
                        <div class="col-6">
                            <a href="/expenses/pending" class="btn btn-outline-info w-100 mb-2">
                                <i class="fas fa-file-invoice-dollar me-2"></i> Expenses
                            </a>
                        </div>
                        <div class="col-6">
                            <a href="/salaries/company" class="btn btn-outline-warning w-100 mb-2">
                                <i class="fas fa-money-check-alt me-2"></i> Salaries
                            </a>
                        </div>
                        <div class="col-6">
                            <a href="/reports/attendance" class="btn btn-outline-secondary w-100 mb-2">
                                <i class="fas fa-chart-bar me-2"></i> Reports
                            </a>
                        </div>
                        <div class="col-6">
                            <a href="/users/create" class="btn btn-outline-dark w-100 mb-2">
                                <i class="fas fa-user-plus me-2"></i> Add Employee
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            // Attendance Chart
            const attendanceCtx = document.getElementById('attendanceChart').getContext('2d');
            const attendanceChart = new Chart(attendanceCtx, {
                type: 'bar',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Present',
                        data: [45, 42, 44, 43, 40, 15, 8],
                        backgroundColor: '#43e97b',
                        borderColor: '#43e97b',
                        borderWidth: 1
                    }, {
                        label: 'Absent',
                        data: [5, 8, 6, 7, 10, 0, 0],
                        backgroundColor: '#f5576c',
                        borderColor: '#f5576c',
                        borderWidth: 1
                    }, {
                        label: 'Late',
                        data: [3, 5, 4, 6, 8, 0, 0],
                        backgroundColor: '#ffc107',
                        borderColor: '#ffc107',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                drawBorder: false
                            },
                            ticks: {
                                stepSize: 10
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });

            // Department Distribution Chart
            const departmentCtx = document.getElementById('departmentChart').getContext('2d');
            const departmentChart = new Chart(departmentCtx, {
                type: 'doughnut',
                data: {
                    labels: ['IT', 'HR', 'Finance', 'Sales', 'Marketing', 'Operations'],
                    datasets: [{
                        data: [25, 15, 20, 18, 12, 10],
                        backgroundColor: [
                            '#667eea',
                            '#f093fb',
                            '#4facfe',
                            '#43e97b',
                            '#ffc107',
                            '#f5576c'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    cutout: '70%'
                }
            });

            // Task completion
            $('.form-check-input').change(function () {
                const taskItem = $(this).closest('.task-item');
                if ($(this).is(':checked')) {
                    taskItem.css('opacity', '0.6');
                    taskItem.find('h6').css('text-decoration', 'line-through');
                } else {
                    taskItem.css('opacity', '1');
                    taskItem.find('h6').css('text-decoration', 'none');
                }
            });

            // Initialize tooltips
            $('[data-bs-toggle="tooltip"]').tooltip();
        });
    </script>